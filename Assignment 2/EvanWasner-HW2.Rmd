---
title: "Econ 753 HW2"
author: "Evan Wasner"
date: "10/13/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

``` {r}
load("cor59.Rdata")
load("cor65.Rdata")
load("chow65.lm.Rdata")
load("priceIndexTable.Rdata")
load("priceIndexTable2.Rdata")
load("priceIndexTable3.Rdata")
load("chow65.gls.Rdata")
load("cpiUAnnual.Rdata")
load("CcpiUAnnual.Rdata")
load("RcpiURSAnnual.Rdata")
```

# Part 1 - Berndt Exercises

In part 1, we analyze a hedonic price model constructed by Gregory Chow in the rental market for computers. Chow constructs a quality-controlled model of price indices using memory time, multiplication time, and access time as the set of qualitative characteristics. We are asked to replicate Chow's results and perform further analysis.

## Question 3a

In question 3a, we construct a correlation matrix for the regession variables, both for the 1954-1959 and 1960-1965 time periods.

```{r, layout="l-body-outset"}
library(knitr)
kable(cor59, caption="Correlation Matrix for 1954-1959")
kable(cor65, caption="Correlation Matrix for 1960-1965")
```

We can see that the variables are all highly correlated with each other, with many of the correlation coefficients coming close to 1. This indicates that Chow's concern over collinearity was a valid concern, as several of the independent variables maintained high correlation coefficients (e.g. the correlation between lnmult and lnaccess is 0.863 in the 1954-1959 range and 0.774 in the 1960-1965 range). 

The correlation coefficients maintained the same signs throughout the two periods, but changed somewhat significantly in values, with the change in magnitudes of some of the correlation coefficients changing by as much as 30%. Therefore, it was correct for Chow to perform separate regressions for the two time periods, as the relation between qualitative characteristics changed somewhat significantly between the two price periods.

## Question 3b

In part b, we run a regression for the years 1960-1965 of lnrent on lnmult, lnmem, lnaccess, and a list of dummy variables indicating if the observation takes place in a particular year (excluding the year 1960). 

```{r results = "asis", message=FALSE, layout="l-body-outset"}
library(stargazer)
stargazer(chow65.lm, type = "latex", style = "default", intercept.bottom = FALSE, header=FALSE,
          title="Quality-Controlled Regression of lnrent on Quality-Variables")
```

```{r fig.cap="Chow's Original Regression"}
knitr::include_graphics("Berndt_Regression.png")
```

The regression successfully replicated Chow's results. Each of the qualitative variables result in the correctly predicted signs; multiplication time and access time both correlate negatively with computer rental price (the longer the multiplication times and access times, the slower the computer and thus the lower the price), while memory correlates positively with rental price (more memory means higher quality computer). Furthermore, each of the qualitative variables are statistically significant. 

The coefficients on the year dummy variables decrease as the year increases, which corresponds to the rental price of computers lowering over time. This intuitively makes sense, as computers have consistently improved in quality while lowering in price for the past 50 years. After running the regression, a list of price indices for the years 1960-1965 is generated by taking the antilogarithm of the dummy variable coefficients. Since the regression was run on the natural logarithm of the rental price, and since the coefficients are relatively small, the antilogarithm of the dummy variable coefficients approximately equals the percent change in the rental price from the year 1960 to the year of the dummy variable. The resulting price indices are identical to Chow's price indices, located in the middle column of the screenshot of the Berndt textbook.

```{r, layout="l-body-outset"}
library(knitr)
kable(priceIndexTable, caption="Replicated Price Indices")
```

```{r fig.cap="Chow's Original Price Indices"}
knitr::include_graphics("Berndt_Price_Indices.png")
```

## Question 3e

In part e, we are asked to perform a generalized least squares (GLS) regression, using the square root of the number of observations (volume) as the weight. Using the number of observations as a weight for our regression attempts to overcome the issue of heteroskedacity, as OLS ceases to be the best linear unbiased estimator (BLUE) in the case of heteroskedacity.

\newpage

Table 5 displays a comparison between the OLS and GLS regressions. None of the coefficients change significantly; all retain their signs and remain more or less within range of the OLS regression. Furthermore, the standard errors do not change significantly either except for general slight increases, as would be expected when controlling for heteroskedacity. What does change, however, is that the coefficient on lnmult is no longer statistically significant, as the coefficient decreased enough to be within range of the standard error.

Generally, performing a log-log regression tends to reduce the impact of heteroskedacity, as the logarithm function "pulls in" large numbers, thus reducing the spread between error terms. However, when variables are small numbers, log-log regressions can actually worsen the problem of heteroskedacity, as taking the logarithm of small numbers tends to increase the spreads. In our case, most of the variables we are dealing with are greater than 1, and thus the problem of heteroskedacity is probably mitigated a bit by performing the log-log regression.

```{r results = "asis", message=FALSE}
library(stargazer)
stargazer(chow65.lm, chow65.gls, type = "latex", style = "default", intercept.bottom = FALSE, header=FALSE,
          title="Comparison of OLS and GLS for Hedonic Price Model",
          column.labels = c("OLS", "WLS"))
```

## Question 6a

In question 6a, we run 11 separate regressions for each two-year section of the 1954-1965 period, with one dummy variable in each regression indicating whether the data is in the later year of the two-year section. Using these 11 separate regressions, we allow the coefficients on the qualitative variables to change over time, instead of holding them constant over the full 12 year period. We are then asked to compare the dummy variable coefficients for the adjacent year regressions with the dummy variable coefficients for a single regression encapsulating the full 12 year period. The comparison is given in Table 6.

```{r, layout="l-body-outset"}
library(knitr)
kable(priceIndexTable2, caption="Comparison of Pooled vs Adjecent Year Regression Coefficients")
```

We can see that the coefficients for the two methods differ significantly. Instead, it makes more sense to compare the adjacent year regression coefficients with the yearly change in the pooled coefficients. This is because the dummy variable coefficients in the full pooled regression all indicate the difference in lnrent from that year to the base year. For example, the coefficient on d61 is indicating the change in lnrent from the year 1954 to the year 1961. Whereas, for the adjacent year regressions, each dummy variable coefficient indicates the change in ln rent from year to year. In Table 6, it is clear that the change in the pooled regression coefficients remains much closer to the adjacent year regression coefficients.

## Question 6b

In part 6b, we construct two sets of price indices. The first is constructed from the pooled regression over the 12 year period by exponentiating the 11 dummy variable coefficients. The second is constructed by cumulatively summing the dummy variable coefficients on for each adjacent-year regression. The results are give in Table 7.

```{r, layout="l-body-outset"}
library(knitr)
kable(priceIndexTable3, caption="Comparison of Pooled vs Chained Price Indices")
```

We can see that the indices do not differ significantly, but the chained price indices are generally lower than the pooled indices, indicating greater changes in prices from the chained indices. The latter method is called "chained indexing" because the indices are "chained" (i.e. connected) to changes in quality over time. That is, the chained CPI index allows the coefficients on the qualitative variables in the regression to change from year to year, instead of holding them constant throughout the entire period. To me, the chained-CPI seems to be a more accurate depiction of changes in the CPI, as the assumption of constant effects of quality on pricing over time seems unjustified, especially over significant time periods. 

# Part 2 - Price Index and Minimum Wage Exercise

## Question 1

We begin by calculating inflation for three different CPI indices: CPI-U, C-CPI (chained CPI-U), and CPI-U-RS (research series using current methods). The CPI-U is available from the BLS from all years since 1968. The C-CPI-U is only available from 1999, thus the only years plotted are after 1999. For the CPI-U-RS, the only years available are after 1977. In order to predict values for the years 1968-1977, the percent change in each year for the CPI-U-X1 series is calculated, and the CPI-U-RS values were extrapolated backwards from 1978. Each CPI index was converted to base year 2018, and inflation rates were gathered by calculating yearly percent changes in the CPI. The results are plotted in Figure X.

```{r fig.cap="Inflation Rate for Different CPI Indicies", message=FALSE}
library(tidyverse)
ggplot(filter(bind_rows(cpiUAnnual,CcpiUAnnual,RcpiURSAnnual), 
                               year >= 1970), aes(x=year)) + 
  geom_point(aes(y=inflation, color=type), size=2) +
  scale_x_discrete(breaks=c(1970,1980,1990,2000,2010,2020)) + theme_bw()
```

## Question 2



# Part 3 - Replication Paper Topic

Clark LP, Millet DB, Marshall JD (2014). National Patterns in Environmental Injustice and Inequality: Outdoor $NO_2$ Air Pollution in the United States. PLoS ONE 9(4): e94431. doi:10.1371/journal.pone.0094431

For my replication paper, I will replicate the paper titled "National Patterns in Environmental Injustice and Inequality: Outdoor $NO_2$ Air Pollution in the United States" by Clark et al. The paper describes spatial patterns in environmental injustice and inequality for nitrogen dioxide ($NO_2$) concentrations in the United States. It uses Census demographic data and a recently published dataset of outdoor ($NO_2$) concentrations. It compares ($NO_2$) concentrations in populations of different demographics and in different locations (e.g. urban vs rural). 

There are three tables and two figures. Table 1 provides data on ($NO_2$) concentration for different populations. Table 2 offers comparisons of specific populations. Table 3 provides "environmental justice" and "environmental inequality" indices for different areas. Figure 1 plots a regression of ($NO_2$) concentration on household income for different regions. Figure 2 projects the environmental justice and inequality indices onto a map of the United states. I am interested in replicating all tables and figures, although I will likely be unable to replicate the figure of the US map. Finally, I am interested in taking a deeper look at the data and offer any other revelations I come across.
